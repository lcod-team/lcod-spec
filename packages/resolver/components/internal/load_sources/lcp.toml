schemaVersion = "2.0"
id = "lcod://tooling/resolver/internal/load-sources@0.1.0"
version = "0.1.0"
kind = "function"
summary = "Resolve resolver sources.json into inline registry catalogue entries."

[deps]
requires = [
  "lcod://tooling/registry_sources/resolve@0.1.0",
  "lcod://impl/set@1"
]

[tool]
name = "load_sources"
description = "Read sources.json, fetch referenced catalogues, and emit registry source payloads ready for indexing."
inputSchema = "schema/input.json"
outputSchema = "schema/output.json"

[inputs.projectPath]
summary = "Base directory of the project invoking the resolver."
required = true
schema = """
{ "type": "string", "minLength": 1 }
"""

[inputs.cacheDir]
summary = "Directory used to cache downloaded catalogues."
required = false
schema = """
{ "type": "string", "minLength": 1 }
"""

[inputs.sourcesPath]
summary = "Explicit path to a sources.json file. Defaults to <projectPath>/sources.json."
required = false
schema = """
{ "type": "string", "minLength": 1 }
"""

[inputs.resolverConfig]
summary = "Resolved resolver configuration (resolve.config.json) used for fallbacks."
required = false
schema = """
{ "type": "object" }
"""

[outputs.registrySources]
summary = "Inline registry entries ready for indexing."
schema = """
{
  "type": "array",
  "items": {
    "type": "object",
    "required": ["id", "type"],
    "properties": {
      "id": { "type": "string" },
      "type": { "type": "string" },
      "priority": { "type": "integer" },
      "defaults": { "type": "object" },
      "lines": { "type": "array", "items": { "type": "object" } },
      "jsonl": { "type": "string" }
    },
    "additionalProperties": true
  }
}
"""

[outputs.warnings]
summary = "Resolved warnings while gathering catalogues."
schema = """
{ "type": "array", "items": { "type": "string" } }
"""

[outputs.sourcesPath]
summary = "Path to the sources.json file used for this run."
schema = """
{ "type": ["string", "null"] }
"""

[slots]

[documentation]
body = """
Loads a resolver `sources.json`, fetches the referenced catalogues, and emits
registry source records that the existing registry tooling can consume.

The component understands pointer entries served over `file`, `http(s)` and
`git` transports. Pointer payloads may either be:

- `lcod-registry/catalogues@1` (catalogue of catalogues) which is expanded
  recursively.
- `lcod-registry/catalogue@1` listing components and versions.

Each concrete catalogue is converted into an inline source with the same shape
as the legacy `registry.sources` configuration so downstream steps can reuse
`tooling/registry/source/load@0.1.0` unchanged."""
